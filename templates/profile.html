{% extends 'base.html' %}

{% block content %}
<div class="row mb-5 align-items-center border-bottom pb-3">
    <div class="col-md-8">
        <h1 class="display-4 fw-bolder text-primary">
            <i class="bi bi-person-fill me-2"></i>Hello, {{ user[1] }}!
        </h1>
        <p class="lead text-muted">Welcome to your dashboard.</p>
    </div>
    <div class="col-md-4 text-md-end">
        <a href="/add_item" class="btn btn-success btn-lg shadow-sm">
            <i class="bi bi-plus-circle me-2"></i>Add New Item
        </a>
    </div>
</div>

<div class="row g-4">
    <div class="col-lg-4">
        <div class="card shadow-sm h-100 border-0">
            <div class="card-header bg-light fw-bold fs-5"><i class="bi bi-info-circle me-2"></i>Your Details</div>
            <div class="card-body">
                <ul class="list-group list-group-flush">
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <span class="fw-bold">Email:</span>
                        <span>{{ user[2] }}</span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <span class="fw-bold">Mobile No.:</span>
                        <span>{{ user[3] | default('N/A') }}</span>
                    </li>
                    <li class="list-group-item">
                        <span class="fw-bold d-block mb-1">Address:</span>
                        <span>{{ user[4] | default('N/A') }}</span>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <div class="col-lg-8">
        <div class="card shadow h-100 border-0">
            <div class="card-body p-0">
                <ul class="nav nav-tabs nav-fill" id="profileTab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active fw-bold" id="items-tab" data-bs-toggle="tab" data-bs-target="#items" type="button" role="tab" aria-controls="items" aria-selected="true">
                            <i class="bi bi-box-seam me-1"></i>Your Items
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link fw-bold" id="bids-tab" data-bs-toggle="tab" data-bs-target="#bids" type="button" role="tab" aria-controls="bids" aria-selected="false">
                            <i class="bi bi-tags me-1"></i>Your Bids
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link fw-bold" id="wins-tab" data-bs-toggle="tab" data-bs-target="#wins" type="button" role="tab" aria-controls="wins" aria-selected="false">
                            <i class="bi bi-trophy me-1"></i>Won Items
                        </button>
                    </li>
                </ul>
                
                <div class="tab-content p-4" id="profileTabContent">
                    
                    <div class="tab-pane fade show active" id="items" role="tabpanel" aria-labelledby="items-tab">
                        {% if user_items %}
                            <ul class="list-group list-group-flush">
                                {% for item in user_items %}
                                    <li class="list-group-item d-flex justify-content-between align-items-center py-3">
                                        <div>
                                            <span class="fw-bold text-dark">{{ item[1] }}</span>
                                            <span class="text-muted small d-block">
                                                Starting Price: â‚¹{{ item[2] }} 
                                                {% if item[4] %} 
                                                    | Sold to <span class="text-success">{{ item[4] }}</span> for <span class="text-success fw-bold">â‚¹{{ item[3] }}</span>
                                                {% else %}
                                                    | <span class="text-info">Currently Bidding...</span>
                                                {% endif %}
                                            </span>
                                        </div>
                                        <div>
                                            {% if not item[4] %}
                                            <form action="{{ url_for('end_auction', item_id=item[0]) }}" method="POST" style="display:inline;">
                                                <button type="submit" class="btn btn-danger btn-sm shadow-sm" onclick="return confirm('Are you sure you want to end the auction for {{ item[1] }}?');">
                                                    <i class="bi bi-stop-circle me-1"></i>End Auction
                                                </button>
                                            </form>
                                            {% else %}
                                            <span class="badge bg-success-subtle text-success border border-success">Auction Ended</span>
                                            {% endif %}
                                        </div>
                                    </li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            <div class="alert alert-info text-center">You have not added any items yet. Start a new auction!</div>
                        {% endif %}
                    </div>
                    
                    <div class="tab-pane fade" id="bids" role="tabpanel" aria-labelledby="bids-tab">
                        {% if user_bids %}
                            <ul class="list-group list-group-flush">
                                {% for bid in user_bids %}
                                    <li class="list-group-item d-flex justify-content-between align-items-center py-2 border-bottom">
                                        <span class="fw-semibold">{{ bid[1] }}</span>
                                        <span class="text-info fw-bolder">Bid: â‚¹{{ bid[0] }}</span>
                                    </li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            <div class="alert alert-warning text-center">You have not placed any bids yet.</div>
                        {% endif %}
                    </div>
                    
                    <div class="tab-pane fade" id="wins" role="tabpanel" aria-labelledby="wins-tab">
                        {% if user_wins %}
                            <ul class="list-group list-group-flush">
                                {% for win in user_wins %}
                                    <li class="list-group-item py-2 bg-success-subtle border-success">
                                        <span class="fw-bold">{{ win[0] }}</span> Sold to you for 
                                        <span class="text-success fw-bolder">â‚¹{{ win[1] }}!</span> Congratulations! ðŸŽ‰
                                    </li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            <div class="alert alert-secondary text-center">You have not won any items yet. Keep bidding!</div>
                        {% endif %}
                    </div>
                    
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
